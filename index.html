<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOTã‚«ãƒªã‚­ãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š --- */
      :root {
        --primary-color: #4092ff;
        --secondary-color: #6c757d;
        --danger-color: #f75555;
        --background-color: #1f2129;
        --surface-color: #2a2d38;
        --text-color: #e0e0e0;
        --border-color: #3b3f4d;
        --border-radius: 8px;
        --font-family: "Noto Sans JP", sans-serif;
      }
      /* --- åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
      html,
      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-family);
        background-color: var(--background-color);
        color: var(--text-color);
      }
      .container {
        max-width: 400px;
        min-height: 100vh;
        margin: 0 auto;
        background-color: #23252d;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
      }
      .content-wrapper {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }
      .page {
        padding: 15px;
        box-sizing: border-box;
        flex-grow: 1;
      }
      .page-title {
        text-align: center;
        color: #fff;
        margin-top: 0;
        margin-bottom: 16px;
        font-size: 1.3em;
      }
      .footer {
        text-align: center;
        font-size: 0.8em;
        color: #888;
        padding: 10px;
        border-top: 1px solid var(--border-color);
        flex-shrink: 0;
      }
      /* --- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ --- */
      .input-group {
        margin-bottom: 8px;
      }
      label {
        display: block;
        margin-bottom: 3px;
        font-weight: 700;
        font-size: 0.9em;
      }
      input[type="text"],
      input[type="time"],
      select {
        padding: 9px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        box-sizing: border-box;
        font-size: 1em;
        font-family: var(--font-family);
        width: 100%;
        background-color: var(--surface-color);
        color: var(--text-color);
      }
      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 12px;
      }
      .btn {
        width: 100%;
        padding: 10px;
        color: white;
        border: none;
        border-radius: var(--border-radius);
        font-size: 1em;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.1s, filter 0.1s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .btn-primary {
        background-color: var(--primary-color);
      }
      .btn-secondary {
        background-color: var(--secondary-color);
      }
      .btn-danger {
        background-color: var(--danger-color);
      }
      .btn:active {
        transform: scale(0.98);
        filter: brightness(0.9);
      }
      .link-button {
        font-size: 0.9em;
        color: var(--primary-color);
        cursor: pointer;
        border: none;
        background: none;
        padding: 5px;
      }
      .player-input-container {
        background-color: var(--surface-color);
        border: 1px solid #485c7d;
        border-radius: var(--border-radius);
        padding: 12px;
        margin-bottom: 10px;
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      .remove-player-btn {
        position: absolute;
        top: -8px;
        right: -8px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background-color: var(--danger-color);
        color: white;
        font-size: 1.2em;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 2px solid var(--background-color);
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
      .result-list {
        margin-top: 20px;
        padding: 0;
        list-style: none;
      }
      .result-item {
        background-color: #3b3f4d;
        padding: 10px;
        border-radius: var(--border-radius);
        margin-bottom: 8px;
        font-weight: bold;
        color: #fff;
      }
      .radio-group {
        display: flex;
        gap: 20px;
      }
      .radio-group input {
        width: auto;
      }
      .radio-group label {
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: normal;
        margin-bottom: 0;
      }
      .input-row {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }
      .input-row .input-group {
        flex-grow: 1;
        margin-bottom: 0;
      }
      .time-select-group {
        display: flex;
        gap: 5px;
      }
      .time-select-group select {
        flex: 1;
        background-color: #3b3f4d;
        color: #e0e0e0;
      }
      #utc-timer {
        font-size: 1.2em;
        text-align: center;
        margin-bottom: 15px;
        font-weight: bold;
        color: #40c0ff;
      }
      #copy-button {
        margin-top: 10px;
      }
      .player-input-container .input-row {
        margin-top: 0px;
      }
      .player-input-container .input-row .input-group:first-child {
        flex: 2;
      }
      .player-input-container .input-row .input-group:last-child {
        flex: 1.5;
      }
      #call-to-action-btn {
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="content-wrapper">
        <main id="page-main" class="page">
          <h1 class="page-title">TOTã‚«ãƒªã‚­ãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
          <button id="call-to-action-btn" class="btn btn-primary">
            é›†çµå‘¼ã³ã‹ã‘
          </button>
          <div id="utc-timer"></div>

          <div id="player-inputs"></div>

          <button id="add-player-btn" class="btn btn-secondary">
            + ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
          </button>

          <div class="input-group" style="margin-top: 20px">
            <label>é›†çµå¾…æ©Ÿæ™‚é–“</label>
            <div class="radio-group">
              <label
                ><input type="radio" name="rally-time" value="300" checked />
                5åˆ†</label
              >
              <label
                ><input type="radio" name="rally-time" value="60" /> 1åˆ†</label
              >
            </div>
          </div>

          <div class="input-group">
            <label for="arrival-time">ç›®æ¨™ç€å¼¾æ™‚é–“</label>
            <input type="time" step="1" id="arrival-time" />
          </div>

          <div class="button-group">
            <button id="btn-reset" class="btn btn-danger">ãƒªã‚»ãƒƒãƒˆ</button>
            <button id="btn-calculate" class="btn btn-primary">è¨ˆç®—</button>
          </div>

          <div id="result-area">
            <ul id="result-list" class="result-list"></ul>
            <button
              id="copy-button"
              class="btn btn-secondary"
              style="display: none"
            >
              ãƒãƒ£ãƒƒãƒˆã«ã‚³ãƒ”ãƒ¼
            </button>
          </div>
        </main>
      </div>
      <footer class="footer">Â© KINNIKU-N</footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const playerInputsContainer = document.getElementById("player-inputs");
        const addPlayerBtn = document.getElementById("add-player-btn");
        const calculateBtn = document.getElementById("btn-calculate");
        const resetBtn = document.getElementById("btn-reset");
        const arrivalTimeInput = document.getElementById("arrival-time");
        const resultList = document.getElementById("result-list");
        const utcTimerDisplay = document.getElementById("utc-timer");
        const copyButton = document.getElementById("copy-button");
        const callToActionBtn = document.getElementById("call-to-action-btn");

        let playerCount = 0;
        let calculatedResults = [];

        // UTCã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        const updateUTCTime = () => {
          const now = new Date();
          const utcHours = now.getUTCHours();
          const utcMinutes = now.getUTCMinutes();
          const utcSeconds = now.getUTCSeconds();
          utcTimerDisplay.textContent = `ç¾åœ¨UTCæ™‚åˆ»: ${String(
            utcHours
          ).padStart(2, "0")}:${String(utcMinutes).padStart(2, "0")}:${String(
            utcSeconds
          ).padStart(2, "0")}`;
        };

        // 1ç§’ã”ã¨ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°
        setInterval(updateUTCTime, 1000);
        updateUTCTime(); // åˆå›è¡¨ç¤º

        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        const createTimeOptions = (limit) => {
          let options = "";
          for (let i = 0; i <= limit; i++) {
            options += `<option value="${i}">${String(i).padStart(
              2,
              "0"
            )}</option>`;
          }
          return options;
        };

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        const createPlayerInput = () => {
          playerCount++;
          const div = document.createElement("div");
          div.className = "player-input-container";
          div.innerHTML = `
            <button class="remove-player-btn" type="button">ï¼</button>
            <div class="input-row">
              <div class="input-group">
                <input type="text" class="player-name" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ${playerCount}" />
              </div>
              <div class="input-group">
                <div class="time-select-group">
                  <select class="marching-time min-select">
                    ${createTimeOptions(59)}
                  </select>
                  <select class="marching-time sec-select">
                    ${createTimeOptions(59)}
                  </select>
                </div>
              </div>
            </div>
          `;
          return div;
        };

        // æœ€åˆã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¿½åŠ 
        playerInputsContainer.appendChild(createPlayerInput());

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ ãƒœã‚¿ãƒ³
        addPlayerBtn.addEventListener("click", () => {
          playerInputsContainer.appendChild(createPlayerInput());
        });

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤ãƒœã‚¿ãƒ³
        playerInputsContainer.addEventListener("click", (e) => {
          if (e.target.classList.contains("remove-player-btn")) {
            e.target.closest(".player-input-container").remove();
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå·ã‚’æŒ¯ã‚Šç›´ã™
            document
              .querySelectorAll(".player-input-container")
              .forEach((el, index) => {
                el.querySelector(".player-name").placeholder = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ${
                  index + 1
                }`;
              });
            playerCount = document.querySelectorAll(
              ".player-input-container"
            ).length;
          }
        });

        // è¡Œè»æ™‚é–“ã‚’ç§’ã«å¤‰æ›ã™ã‚‹é–¢æ•°
        const getMarchingSeconds = (playerDiv) => {
          const minutes = parseInt(
            playerDiv.querySelector(".min-select").value
          );
          const seconds = parseInt(
            playerDiv.querySelector(".sec-select").value
          );
          return minutes * 60 + seconds;
        };

        // æ™‚é–“æ–‡å­—åˆ—ï¼ˆHH:MM:SSï¼‰ã‚’ç§’ã«å¤‰æ›ã™ã‚‹é–¢æ•°
        const arrivalTimeToSeconds = (timeStr) => {
          const parts = timeStr.split(":");
          if (parts.length !== 3) return NaN;
          const hours = parseInt(parts[0]);
          const minutes = parseInt(parts[1]);
          const seconds = parseInt(parts[2]);
          if (
            isNaN(hours) ||
            isNaN(minutes) ||
            isNaN(seconds) ||
            hours < 0 ||
            hours > 23 ||
            minutes < 0 ||
            minutes > 59 ||
            seconds < 0 ||
            seconds > 59
          )
            return NaN;
          return hours * 3600 + minutes * 60 + seconds;
        };

        // ç§’ã‚’æ™‚é–“æ–‡å­—åˆ—ï¼ˆHH:MM:SSï¼‰ã«å¤‰æ›ã™ã‚‹é–¢æ•°
        const secondsToTime = (totalSeconds) => {
          const hours = Math.floor(totalSeconds / 3600) % 24;
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;
          return `${String(hours).padStart(2, "0")}:${String(minutes).padStart(
            2,
            "0"
          )}:${String(seconds).padStart(2, "0")}`;
        };

        // è¨ˆç®—ãƒœã‚¿ãƒ³
        calculateBtn.addEventListener("click", () => {
          resultList.innerHTML = "";
          calculatedResults = [];
          const rallyTime = parseInt(
            document.querySelector('input[name="rally-time"]:checked').value
          );
          const arrivalSeconds = arrivalTimeToSeconds(arrivalTimeInput.value);

          if (isNaN(arrivalSeconds)) {
            alert("æœ‰åŠ¹ãªç›®æ¨™ç€å¼¾æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (HH:MM:SS)ã€‚");
            copyButton.style.display = "none";
            return;
          }

          const players = document.querySelectorAll(".player-input-container");
          players.forEach((playerDiv, index) => {
            const nameInput = playerDiv.querySelector(".player-name");

            const playerName = nameInput.value || `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ${index + 1}`;
            const marchingSeconds = getMarchingSeconds(playerDiv);

            // è¨ˆç®—
            let departureSeconds = arrivalSeconds - marchingSeconds - rallyTime;

            // æ—¥ä»˜ã‚’ã¾ãŸãå ´åˆã®èª¿æ•´
            if (departureSeconds < 0) {
              departureSeconds += 24 * 3600;
            }

            const departureTimeFormatted = secondsToTime(departureSeconds);
            calculatedResults.push({
              name: playerName,
              time: departureTimeFormatted,
            });

            const resultItem = document.createElement("li");
            resultItem.className = "result-item";

            resultItem.textContent = `${
              index + 1
            }. ${playerName} ã®é›†çµé–‹å§‹æ™‚é–“: ${departureTimeFormatted}`;
            resultList.appendChild(resultItem);
          });

          if (calculatedResults.length > 0) {
            copyButton.style.display = "block";
          }
        });

        // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
        resetBtn.addEventListener("click", () => {
          playerInputsContainer.innerHTML = "";
          playerCount = 0;
          playerInputsContainer.appendChild(createPlayerInput());
          arrivalTimeInput.value = "";
          resultList.innerHTML = "";
          copyButton.style.display = "none";
          document.querySelector(
            'input[name="rally-time"][value="300"]'
          ).checked = true;
        });

        // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
        copyButton.addEventListener("click", () => {
          if (calculatedResults.length > 0) {
            const textToCopy = calculatedResults
              .map((result) => `${result.name}ï¼š${result.time}`)
              .join("\n");

            navigator.clipboard
              .writeText(textToCopy)
              .then(() => {
                alert("è¨ˆç®—çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
              })
              .catch((err) => {
                console.error("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:", err);
                alert(
                  "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãŠæ‰‹æ•°ã§ã™ãŒæ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚"
                );
              });
          }
        });

        // é›†çµå‘¼ã³ã‹ã‘ãƒœã‚¿ãƒ³
        callToActionBtn.addEventListener("click", () => {
          const rallyText = `â‘ é›†çµã‚’å‡ºã™äººã¯ã€ç›®çš„åœ°ã¸ã®è¡Œè»æ™‚é–“ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼

ã€Œæ”»æ’ƒã€â†’ã€Œå‡ºå¾ã€ãƒœã‚¿ãƒ³ã®ä¸Šã®æ•°å­—ã‚’ãƒã‚§ãƒƒã‚¯â†’å‡ºå¾ã›ãšã«é–‰ã˜ã¦æ™‚é–“ã‚’å ±å‘ŠğŸ•
ã€€(ä¾‹)Aã•ã‚“0:15ã€Bã•ã‚“0:09

â‘¡ç›®çš„åœ°ã¾ã§é ã„æ–¹(è¡Œè»æ™‚é–“ãŒé•·ã„æ–¹)ã‚’åŸºæº–ã«ã€Aã•ã‚“ã¨Bã•ã‚“ã®å·®åˆ†ã‚’å…±æœ‰ã€‚
ã€€(ä¾‹)Aã•ã‚“+0ç§’ã€Bã•ã‚“+4ç§’

â‘¢ç”»é¢å·¦ä¸Šã®UTCæ™‚è¨ˆã‚’åŸºæº–ã«å‡ºç™ºæ™‚é–“ã¨é›†çµæ™‚é–“ã‚’æ±ºã‚ã‚‹ã€‚
ã€€UTC12:00:00å‡ºç™ºã®æ™‚
ã€€Aã•ã‚“12:00:00ç™º
ã€€Bã•ã‚“12:00:04ç™º`;

          navigator.clipboard
            .writeText(rallyText)
            .then(() => {
              alert("é›†çµå‘¼ã³ã‹ã‘ã®å®šå‹æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            })
            .catch((err) => {
              console.error("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:", err);
              alert(
                "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãŠæ‰‹æ•°ã§ã™ãŒæ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚"
              );
            });
        });
      });
    </script>
  </body>
</html>
